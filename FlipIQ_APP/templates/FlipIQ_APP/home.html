{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlipIQ - Explore</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background-color: #fffdf8;
      font-family: "Inter", sans-serif;
      color: #2b2b2b;
      position: relative;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* ---------- NAVBAR ---------- */
    .navbar {
      background-color: #ffd42d;
      padding: 1rem 3rem;
    }

    .navbar-brand {
      font-weight: 800;
      font-size: 1.8rem;
    }

    .navbar-nav .nav-link {
      color: #2b2b2b !important;
      font-weight: 600;
      margin-left: 1.5rem;
    }

    /* ---------- PAGE TITLE ---------- */
    .page-title {
      font-weight: 700;
      font-size: 2rem;
      margin: 2rem 3rem 1rem;
    }

    /* ---------- SEARCH + JOIN ---------- */
    .top-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 0 3rem 2rem;
    }

    .join-btn {
      background-color: #ffd42d;
      border: none;
      font-weight: 700;
      padding: 0.6rem 2rem;
      border-radius: 30px;
      transition: 0.2s;
    }

    .join-btn:hover {
      background-color: #f1c425;
    }

    .search-box {
      flex-grow: 1;
      position: relative;
    }

    .search-box input {
      width: 100%;
      border: none;
      border-radius: 30px;
      padding: 0.6rem 3rem 0.6rem 1.2rem;
      background-color: #f6f6f6;
    }

    .search-box i {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #555;
    }

    /* ---------- FLOATING CREATE BUTTON ---------- */
    .create-deck-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: #ffd42d;
      color: #000;
      font-size: 2rem;
      border: none;
      border-radius: 50%;
      width: 65px;
      height: 65px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      cursor: pointer;
      transition: background 0.2s;
      z-index: 1000;
    }

    .create-deck-btn:hover {
      background-color: #f1c425;
    }

    /* ---------- EMPTY STATE ---------- */
    .empty-message {
      text-align: center;
      margin-top: 80px;
      color: #777;
      font-weight: 600;
    }
    .deck-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 2rem;
  padding: 2rem 3rem 4rem;
}

.deck-card {
  border: 3px solid #9b6400;
  border-radius: 20px;
  background-color: #fff;
  text-align: center;
  transition: transform 0.2s ease;
  overflow: hidden;
}

.deck-card:hover { transform: translateY(-5px); }

.deck-title {
  font-weight: 800;
  font-size: 1.7rem;
  margin-top: 2rem;
  border-bottom: 2px solid #9b6400;
  padding-bottom: 0.5rem;
}

.deck-footer {
  border-top: none;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background-color: #fff;
}

.deck-meta {
  font-size: 0.9rem;
  color: #444;
  text-align: left;
}

.add-deck-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  background: #ffd42d;
  border: none;
  border-radius: 30px;
  padding: 0.5rem 1.2rem;
  font-weight: 700;
  transition: background-color 0.2s;
  font-size: 0.95rem;
  color: #2b2b2b;
  text-decoration: none;
}

.add-deck-btn:hover {
  background-color: #f1c425;
}

  </style>
</head>

<body>
  <!-- ---------- NAVBAR ---------- -->
  <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="#">FlipIQ</a>
    <div class="ms-auto navbar-nav">
      <a class="nav-link" href="{% url 'home' %}">Home</a>
      {% if user.is_authenticated %}
        <a class="nav-link" href="{% url 'profile' %}">Profile</a>
      {% else %}
        <a class="nav-link" href="{% url 'login' %}">Login</a>
      {% endif %}
      <!-- <a class="nav-link" href="#">About us</a> -->
    </div>
  </nav>

  <!-- ---------- PAGE TITLE ---------- -->
  <h2 class="page-title">Explore</h2>

  <!-- ---------- JOIN + SEARCH ---------- -->
  <div class="top-controls">
  <button class="join-btn" onclick="window.location.href='{% url 'join_deck_page' %}'">Join</button>
  <form class="search-box" method="get" action="{% url 'home' %}">
    <input type="text" name="q" placeholder="Search for Decks" value="{{ query }}">
    <button type="submit" style="background:none;border:none;position:absolute;right:1rem;top:50%;transform:translateY(-50%);">
      <i class="bi bi-search"></i>
    </button>
  </form>
</div>

  <!-- ---------- NO DECK MESSAGE ---------- -->
<div class="container mb-5">
  {% if public_decks %}
  <div class="deck-grid">
    {% for deck in public_decks %}
    <div class="deck-card">
      <h3 class="deck-title">{{ deck.title }}</h3>
      <div class="deck-footer">
        <div>
          <div class="deck-meta">{{ deck.cards.count }} cards</div>
          <div class="deck-meta">@{{ deck.owner.username }}</div>
        </div>
        {% if user.is_authenticated %}
          {% if deck.played %}
          <!-- ðŸ”¹ Already played: go to results -->
          <button class="add-deck-btn" onclick="window.location.href='/deck/{{ deck.id }}/result/{{ deck.session_id }}/'">
            <i class="bi bi-bar-chart-fill"></i> Result
          </button>
          {% else %}
          <!-- ðŸ”¸ Not played yet: go to play -->
          <button 
  class="add-deck-btn"
  style="background-color:#ffd42d; border-radius:16px;"
  onclick="window.location.href='?flip={{ deck.id }}'">
  Flip
</button>

          {% endif %}
        {% else %}
          <!-- ðŸ”’ Guest: go to login -->
          <button class="add-deck-btn" onclick="window.location.href='{% url 'login' %}'">
            <i class="bi bi-lock"></i> Flip
          </button>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-message">No decks available yet.</div>
  {% endif %}
</div>
  <!-- ---------- FLOATING ADD BUTTON ---------- -->
  {% if user.is_authenticated %}
  <a href="{% url 'create_deck' %}" class="create-deck-btn">
    <i class="bi bi-plus-lg"></i>
  </a>
  {% endif %}
</body>
</html>
