{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign Up - FlipIQ</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --yellow:#ffd42d;
      --yellow-dark:#f1c425;
      --accent:#9b6400;
      --bg:#ffd42d;
      --page-pad:2rem;
    }
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--bg);
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color:#222;
      overflow:hidden;
    }

    .signup-stage {
      width:100%;
      max-width:1100px;
      height:520px;
      position:relative;
      overflow:hidden;
    }

    .page-logo {
      position:absolute;
      left:calc(50% - 330px);
      top:48px;
      font-weight:900;
      font-size:1.9rem;
      letter-spacing:.5px;
      z-index:30;
      transition: opacity 0.5s ease;
    }
    .page-logo span{
      display:block;
      font-size:.6rem;
      font-weight:600;
      color:#444;
    }

    .show-form .page-logo {
      opacity:0;
      pointer-events:none;
    }

    .panels-wrapper {
      position:absolute;
      inset:0;
      transition:transform .65s cubic-bezier(.2,.9,.2,1);
      will-change:transform;
    }

    .panel {
      height:100%;
      width:100%;
      display:grid;
      grid-template-columns:1fr 1fr;
      align-items:center;
      gap:2rem;
      padding:0 var(--page-pad);
      box-sizing:border-box;
    }

    .role-card {
      width:340px;
      background:#fff;
      border-radius:18px;
      padding:2.2rem 2.4rem;
      box-shadow:0 6px 22px rgba(0,0,0,0.08);
      align-self:center;
      margin-left:50px;
      text-align:center;
    }

    .role-title{font-weight:700;margin-bottom:1rem;}
    .role-btn {
      display:block;
      margin:.6rem auto;
      background:var(--yellow);
      border:0;
      border-radius:40px;
      padding:.6rem 2.2rem;
      font-weight:700;
      width:160px;
      transition:background .15s;
      box-shadow:none;
    }
    .role-btn:hover{background:var(--yellow-dark)}

    .who-text {
      font-size:3.2rem;
      font-weight:800;
      line-height:1.03;
      padding-left:1rem;
    }

    .form-card {
      width:380px;
      background:#fff;
      border-radius:18px;
      padding:2rem;
      box-shadow:0 6px 22px rgba(0,0,0,0.08);
      margin-left:50px;
    }

    .form-title{
      font-weight:800;
      font-size:2.6rem;
      line-height:1.03;
      padding-left:1rem;
    }

    .form-control {
      border:2px solid var(--yellow);
      border-radius:10px;
      padding:.7rem .9rem;
      box-shadow:none;
    }

    .checkbox-label{font-size:.9rem;color:#444}
    .btn-create{
      background:var(--yellow);
      border:0;border-radius:30px;padding:.6rem 1.2rem;font-weight:700;width:100%;
    }
    .btn-create:hover{background:var(--yellow-dark)}

    .back-link{
      position:absolute;left:18px;top:18px;color:#111;font-weight:600;text-decoration:none;
      display:flex;align-items:center;gap:.4rem;z-index:50;
      transition: opacity 0.4s ease;
    }

    .back-link.hidden {
      opacity:0;
      pointer-events:none;
    }

    .show-form .panels-wrapper{ transform: translateY(-100%); }

    @media (max-width:900px){
      .panel{grid-template-columns:1fr; padding:0 1.2rem}
      .page-logo{left:20px;top:22px}
      .role-card{margin-left:0;width:90%}
      .form-card{margin-left:0;width:90%}
      .who-text{font-size:2.2rem;text-align:center;padding:0}
      .signup-stage{height:740px}
    }
  </style>
</head>
<body>

  <a href="#" class="back-link hidden" id="backBtn"><i class="bi bi-arrow-left"></i>Back</a>

  <div class="signup-stage" id="stage">
    <div class="page-logo">FlipIQ <span></span></div>

    <div class="panels-wrapper" id="panelsWrapper">
      <!-- PANEL 1: role selection -->
      <div class="panel panel-role">
        <div>
          <div class="role-card">
            <div style="height:14px"></div>
            <div class="role-title">What is your role?</div>
            <button type="button" class="role-btn" data-role="teacher">Teacher</button>
            <button type="button" class="role-btn" data-role="student">Student</button>
          </div>
        </div>
        <div><div class="who-text">Who are<br>you?</div></div>
      </div>

      <!-- PANEL 2: signup form -->
      <div class="panel panel-form">
        <div>
          <div class="form-card">
            <div style="font-weight:900;font-size:1.5rem;margin-bottom:.35rem">FlipIQ</div>
            <div style="font-size:.65rem;color:#666;margin-bottom:1rem">CORP</div>

            <!-- âœ… Added action + form error handling -->
            {% if form.errors %}
              <div class="alert alert-danger py-2">
                {% for field in form %}
                  {% for error in field.errors %}
                    <div>{{ error }}</div>
                  {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}

            <form method="post" action="{% url 'signup' %}" novalidate>
              {% csrf_token %}
              <input type="hidden" name="role" id="selectedRole" value="student">

              <div class="row g-2 mb-2">
                <div class="col">
                  <input class="form-control" name="first_name" placeholder="First name" value="{{ request.POST.first_name }}">
                </div>
                <div class="col">
                  <input class="form-control" name="last_name" placeholder="Last name" value="{{ request.POST.last_name }}">
                </div>
              </div>

              <div class="mb-2"><input class="form-control" name="username" placeholder="Email Address" value="{{ request.POST.username }}"></div>
              <div class="mb-2"><input class="form-control" name="password1" type="password" placeholder="Password"></div>
              <div class="mb-2"><input class="form-control" name="password2" type="password" placeholder="Confirm Password"></div>

              <div class="form-check mb-3">
                <input class="form-check-input" id="terms" type="checkbox">
                <label class="form-check-label checkbox-label" for="terms">I agree to the Terms and Conditions</label>
              </div>

              <button class="btn btn-create" type="submit">Create Account</button>
            </form>

            <div style="text-align:center;margin-top:.9rem;font-size:.9rem">
              Already have an account?
              <a href="{% url 'login' %}" style="color:#7c5000;text-decoration:underline">Log in</a>
            </div>
          </div>
        </div>
        <div><div class="form-title">Create an<br>Account</div></div>
      </div>
    </div>
  </div>

<script>
  (function(){
    const stage = document.getElementById('stage');
    const roleButtons = document.querySelectorAll('.role-btn');
    const selectedRoleInput = document.getElementById('selectedRole');
    const backBtn = document.getElementById('backBtn');

    let chosenRole = 'student';

    roleButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        chosenRole = btn.getAttribute('data-role') || 'student';
        selectedRoleInput.value = chosenRole;
        stage.classList.add('show-form');
        backBtn.classList.remove('hidden');
        setTimeout(()=> {
          const input = document.querySelector('input[name="first_name"]');
          if(input) input.focus();
        }, 700);
      });
    });

    backBtn.addEventListener('click',(ev)=>{
      ev.preventDefault();
      stage.classList.remove('show-form');
      backBtn.classList.add('hidden');
    });

    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        stage.classList.remove('show-form');
        backBtn.classList.add('hidden');
      }
    });
  })();
</script>

</body>
</html>
